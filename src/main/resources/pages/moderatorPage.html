<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>Empty page</title>

    <link href="vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <link href="css/moderatorPage.css" rel="stylesheet">
    <script src="vendor/jquery/jquery.min.js"></script>
    <script src="vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
    <script>
        $(function() {
            $("#load-recipes").hide();
            refreshTable();
        });

        function banUnban(name) {
            alert(name);
            var data = {userLogin: name};
            $.ajax({
                type: "post",
                url: "/change/status",
                dataType: "json",
                data,
                contentType: "application/json; charset=utf-8",
                complete: [
                    function (response) {
                        refreshTable();
                    }
                ]
            });
        }

        function banUnbanBtnName(status) {
            if (status == true) {
                return 'Unban';
            } else {
                return 'Ban';
            }
        }

        function refreshTable() {
            $.ajax({
                type: "post",
                url: "/select/users",
                dataType: "json",
                contentType: "application/json; charset=utf-8",
                complete: [
                    function (response) {
                        var answer = $.parseJSON(response.responseText);
                        alert(response.responseText);
                        $("#users-table tbody tr").remove();
                        $.each(answer.obj, function(key, value) {
                            var row = "<tr><td>" + value.login + "</td><td>" + value.name + "</td><td>" + value.surname + "</td><td>" 
                            + value.email + "</td><td>" + value.bannedStatus + "</td><td><button class='ban-btn' onclick='banUnban(\"" + value.login + "\")'>" + banUnbanBtnName(value.bannedStatus)
                            + "</button></td></tr>"
                            $("#users-table tbody").append(row);
                        });
                        
                    }
                ]
            });
        }

    </script>
</head>
<body>
<!-- Page Content -->
<div class="container" id="main-container">
    <div class="row">
        <div class="col-lg-12 text-center">
            <!-- Page Content -->
            <div class="container" id="content-container">
                <table class="table" id="users-table">
                    <thead>
                    <tr>
                        <th scope="col">Login</th>
                        <th scope="col">Name</th>
                        <th scope="col">Surname</th>
                        <th scope="col">Email</th>
                        <th scope="col">Is banned</th>
                        <th scope="col">Action</th>
                    </tr>
                    </thead>
                    <tbody>

                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>
</body>
</html>