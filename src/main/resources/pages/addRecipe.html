<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>Empty page</title>

    <link href="vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet"
          href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datetimepicker/4.7.14/css/bootstrap-datetimepicker.min.css">
    <link href="css/addRecipe.css" rel="stylesheet">

    <script src="vendor/jquery/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.15.1/moment.min.js"></script>
    <script src="vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datetimepicker/4.7.14/js/bootstrap-datetimepicker.min.js"></script>

    <script>
        $(function() {
           $("#load-recipes").hide();
           $("#publicationDate").datetimepicker({
                format: "DD/MM/YYYY HH:mm:ss"
           });
           $("#selectedTypes").find("option").remove();
           $.ajax({
                url:"/select/types",
                type:"post",
                complete: [
                    function (response) {
                        var answer = $.parseJSON(response.responseText);
                        if (answer.obj != "false") {
                            $.each(answer.obj, function(key, value) {
                                //alert(value.typeName);
                                $("#selectedTypes").append($("<option></option>").attr("value",value.typeName).text(value.typeName));
                            });
                        }
                    }
                ]
           });
        });
        function createRecipe() {
            var check = true;
            $("#recipeForm input").each(function() {
                $(this).next("span").hide();
                if ($(this).val() == "") {
                    $(this).after("<span>This field is required</span>");
                    $(this).css("border-color","red");
                    check = false;
                } else {
                    $(this).css("border-color","");
                }
            });
            $("#recipeForm textarea").each(function() {
                $(this).next("span").hide();
                if ($(this).val() == "") {
                    $(this).after("<span>This field is required</span>");
                    $(this).css("border-color","red");
                    check = false;
                } else {
                    $(this).css("border-color","");
                }
            });
            $("#recipeForm select").each(function() {
                $(this).next("span").hide();
                if ($(this).val() == "") {
                    $(this).after("<span>This field is required</span>");
                    $(this).css("border-color","red");
                    check = false;
                } else {
                    $(this).css("border-color","");
                }
            });
            var data = new FormData();
            $.each($("#file")[0].files, function(i, file) {
                data.append("image", file);
            });
            if (!check || data.get("image") == null) {
                return;
            }
            data.append("recipeName", $("#recipeName").val());
            data.append("cookingSteps", $("#cookingSteps").val());
            data.append("recipeComposition", $("#composition").val());

            var selectedTypes = "";
            $.each($("#selectedTypes").val(), function( index, value ) {
                selectedTypes += value + "/";
            });
            selectedTypes = selectedTypes.slice(0, -1);
            data.append("selectedTypes", selectedTypes);
            data.append("publicationDate", $("#publicationDate").val());
            $.ajax({
                url:"/add/recipe",
                type:"post",
                data: data,
                processData: false,
                contentType: false,
                complete: [
                    function (response) {
                        var answer = $.parseJSON(response.responseText);
                        if (answer.status == true) {
                            $("#recipeForm input").each(function() {
                                $(this).val("");
                            });
                            $("#recipeForm textarea").each(function() {
                                $(this).val("");
                            });
                            $("#recipeForm select").each(function() {
                                $(this).val([]);
                            });
                        }
                    }
                ]
            });
         }

    </script>
</head>
<body>
<!-- Page Content -->
<div class="container" id="main-container">
    <div class="row">
        <div class="col-lg-12 text-center">
            <!-- Page Content -->
            <div class="container" id="content-container">
                <div id="recipeForm">
                    <div class="form-group">
                        <label for="recipeName">Name</label>
                        <input type="text" class="form-control" id="recipeName">
                    </div>
                    <div class="form-group">
                        <label for="composition">Ingredients</label>
                        <textarea class="form-control" id="composition" rows="3"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="cookingSteps">Recipe</label>
                        <textarea class="form-control" id="cookingSteps" rows="3"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="publicationDate">Publication date</label>
                        <input type="text" class="form-control" id="publicationDate">
                    </div>
                    <div class="form-group" id="select-form-group">
                        <label for="selectedTypes">Categories</label>
                        <select multiple class="form-control" id="selectedTypes">
                            <option>1.1</option>
                            <option>1.2</option>
                            <option>2.1</option>
                            <option>2.2</option>
                            <option>2.3</option>
                            <option>3.1</option>
                        </select>
                    </div>
                    <div class="form-group" id="img-form-group">
                        <label for="file">Image</label>
                        <input name="image" type="file" class="form-control" id="file"/>
                    </div>
                    <button class="btn btn-primary" id="submitRecipe" onclick="createRecipe()">Submit</button>
                </div>
            </div>
        </div>
    </div>
</div>
</body>
</html>